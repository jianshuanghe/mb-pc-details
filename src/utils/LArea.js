window.LArea=function(){var l=function(){this.gearArea;this.data;this.index=0;this.value=[0,0,0]};l.prototype={init:function(e){this.params=e;this.trigger=document.querySelector(e.trigger);e.valueTo&&(this.valueTo=document.querySelector(e.valueTo));this.keys=e.keys;this.type=e.type||1;switch(this.type){case 1:case 2:break;default:throw Error("\u9519\u8bef\u63d0\u793a: \u6ca1\u6709\u8fd9\u79cd\u6570\u636e\u6e90\u7c7b\u578b");}this.bindEvent()},getData:function(e){var f=this;if("object"==typeof f.params.data)f.data=f.params.data,e();else{var g=new XMLHttpRequest;g.open("get",f.params.data);g.onload=function(d){if(200<=g.status&&300>g.status||0===g.status)d=JSON.parse(g.responseText),f.data=d.data,e&&e()};g.send()}},bindEvent:function(){function e(a){c.gearArea=document.createElement("div");c.gearArea.className="gearArea";c.gearArea.innerHTML='\x3cdiv class\x3d"area_ctrl slideInUp"\x3e\x3cdiv class\x3d"area_btn_box"\x3e\x3cdiv class\x3d"area_btn larea_cancel"\x3e\u53d6\u6d88\x3c/div\x3e\x3cdiv class\x3d"area_btn larea_finish"\x3e\u786e\u5b9a\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"area_roll_mask"\x3e\x3cdiv class\x3d"area_roll"\x3e\x3cdiv\x3e\x3cdiv class\x3d"gear area_province" data-areatype\x3d"area_province"\x3e\x3c/div\x3e\x3cdiv class\x3d"area_grid"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv\x3e\x3cdiv class\x3d"gear area_city" data-areatype\x3d"area_city"\x3e\x3c/div\x3e\x3cdiv class\x3d"area_grid"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv\x3e\x3cdiv class\x3d"gear area_county" data-areatype\x3d"area_county"\x3e\x3c/div\x3e\x3cdiv class\x3d"area_grid"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e';document.body.appendChild(c.gearArea);c.gearArea.querySelector(".area_province").setAttribute("val",c.value[0]);c.gearArea.querySelector(".area_city").setAttribute("val",c.value[1]);c.gearArea.querySelector(".area_county").setAttribute("val",c.value[2]);switch(c.type){case 1:c.setGearTooth(c.data);break;case 2:c.setGearTooth(c.data[0])}c.gearArea.querySelector(".larea_cancel").addEventListener("touchstart",function(a){c.close(a)});c.gearArea.querySelector(".larea_finish").addEventListener("touchstart",function(a){c.finish(a)});a=c.gearArea.querySelector(".area_province");var b=c.gearArea.querySelector(".area_city"),e=c.gearArea.querySelector(".area_county");a.addEventListener("touchstart",f);b.addEventListener("touchstart",f);e.addEventListener("touchstart",f);a.addEventListener("touchmove",g);b.addEventListener("touchmove",g);e.addEventListener("touchmove",g);a.addEventListener("touchend",d);b.addEventListener("touchend",d);e.addEventListener("touchend",d)}function f(a){a.preventDefault();for(var b=a.target;!b.classList.contains("gear");)b=b.parentElement;clearInterval(b["int_"+b.id]);b["old_"+b.id]=a.targetTouches[0].screenY;b["o_t_"+b.id]=(new Date).getTime();a=b.getAttribute("top");b["o_d_"+b.id]=a?parseFloat(a.replace(/em/g,"")):0;b.style.webkitTransitionDuration=b.style.transitionDuration="0ms"}function g(a){a.preventDefault();for(var b=a.target;!b.classList.contains("gear");)b=b.parentElement;b["new_"+b.id]=a.targetTouches[0].screenY;b["n_t_"+b.id]=(new Date).getTime();b["pos_"+b.id]=b["o_d_"+b.id]+30*(b["new_"+b.id]-b["old_"+b.id])/window.innerHeight;b.style["-webkit-transform"]="translate3d(0,"+b["pos_"+b.id]+"em,0)";b.setAttribute("top",b["pos_"+b.id]+"em");1>a.targetTouches[0].screenY&&d(a)}function d(a){a.preventDefault();for(a=a.target;!a.classList.contains("gear");)a=a.parentElement;var b=(a["new_"+a.id]-a["old_"+a.id])/(a["n_t_"+a.id]-a["o_t_"+a.id]);a["spd_"+a.id]=.2>=Math.abs(b)?0>b?-.08:.08:.5>=Math.abs(b)?0>b?-.16:.16:b/2;a["pos_"+a.id]||(a["pos_"+a.id]=0);h(a)}function h(a){function b(){a.style.webkitTransitionDuration=a.style.transitionDuration="200ms";g=!0}var e=0,g=!1;clearInterval(a["int_"+a.id]);a["int_"+a.id]=setInterval(function(){var d=a["pos_"+a.id],f=a["spd_"+a.id]*Math.exp(-.03*e),d=d+f;.1<Math.abs(f)||(d=2*Math.round(d/2),b());0<d&&(d=0,b());f=2*-(a.dataset.len-1);d<f&&(d=f,b());if(g){f=Math.abs(d)/2;f=Math.round(f);a.setAttribute("val",f);switch(c.type){case 1:c.setGearTooth(c.data);break;case 2:switch(a.dataset.areatype){case "area_province":c.setGearTooth(c.data[0]);break;case "area_city":var f=a.childNodes[f].getAttribute("ref"),h=[],k=c.data[2],m;for(m in k)if(m==f){h=k[m];break}c.index=2;c.setGearTooth(h)}}clearInterval(a["int_"+a.id])}a["pos_"+a.id]=d;a.style["-webkit-transform"]="translate3d(0,"+d+"em,0)";a.setAttribute("top",d+"em");e++},30)}var c=this;c.getData(function(){c.trigger.addEventListener("click",e)})},setGearTooth:function(e){e=e||[];var f=e.length,g=this.gearArea.querySelectorAll(".gear"),d=g[this.index].getAttribute("val"),h=f-1;d>h&&(d=h);g[this.index].setAttribute("data-len",f);if(0<f){var h=e[d][this.keys.id],c;switch(this.type){case 1:c=e[d].child;break;case 2:var a=this.data[this.index+1],b;for(b in a)if(b==h){c=a[b];break}}h="";for(b=0;b<f;b++)h+="\x3cdiv class\x3d'tooth'  ref\x3d'"+e[b][this.keys.id]+"'\x3e"+e[b][this.keys.name]+"\x3c/div\x3e";g[this.index].innerHTML=h;g[this.index].style["-webkit-transform"]="translate3d(0,"+2*-d+"em,0)";g[this.index].setAttribute("top",2*-d+"em");g[this.index].setAttribute("val",d);this.index++;2<this.index?this.index=0:this.setGearTooth(c)}else g[this.index].innerHTML="\x3cdiv class\x3d'tooth'\x3e\x3c/div\x3e",g[this.index].setAttribute("val",0),1==this.index&&(g[2].innerHTML="\x3cdiv class\x3d'tooth'\x3e\x3c/div\x3e",g[2].setAttribute("val",0)),this.index=0},finish:function(e){var f=this.gearArea.querySelector(".area_province"),g=this.gearArea.querySelector(".area_city"),d=this.gearArea.querySelector(".area_county"),h=parseInt(f.getAttribute("val")),c=f.childNodes[h].textContent,f=f.childNodes[h].getAttribute("ref"),a=parseInt(g.getAttribute("val")),b=g.childNodes[a].textContent,g=g.childNodes[a].getAttribute("ref"),k=parseInt(d.getAttribute("val")),l=d.childNodes[k].textContent,d=d.childNodes[k].getAttribute("ref");this.trigger.value=c+(b?","+b:"")+(l?","+l:"");this.value=[h,a,k];this.valueTo&&(this.valueTo.value=f+(g?","+g:"")+(d?","+d:""));this.close(e)},close:function(e){e.preventDefault();e=new CustomEvent("input");this.trigger.dispatchEvent(e);document.body.removeChild(this.gearArea);this.gearArea=null}};return l}();
